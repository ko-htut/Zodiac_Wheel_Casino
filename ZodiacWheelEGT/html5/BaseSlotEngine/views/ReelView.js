EventDispatcher("ReelView",{REEL_IDLE:0,REEL_STARTING:1,REEL_ROTATING:2,REEL_STOPPING:3,REEL_BOUNCING:4,REEL_BOUNCED:"reelBounced",REEL_STOPPED:"reelStopped"},function(){function h(){var b=this._result.length;for(i=0;i<b;i++)this._result[i]=-1}function k(){var b=this._config.imageHeight*this._reel_length,a=this._offset%b;0>a&&(a=b+a);return Math.floor(a/this._config.imageHeight)}function c(b){this._state=b;switch(b){case ReelView.REEL_STARTING:this._rotating=!1;c.call(this,ReelView.REEL_ROTATING);
break;case ReelView.REEL_ROTATING:this._rotating=!0;this._stop_after_start&&c.call(this,ReelView.REEL_STOPPING);break;case ReelView.REEL_STOPPING:b=this._offset+this._config.reelRotationDirection*(this._config.numReelImages+2)*this._config.imageHeight;var a=b%this._config.imageHeight;0!=a&&(b=0<this._config.reelRotationDirection?b+(this._config.imageHeight-a):0>b?b-(this._config.imageHeight+a):b-a);var f=this._reel_length*this._config.imageHeight,a=b%f;0>a&&(a+=f);this._result_index=a=Math.floor(a/
this._config.imageHeight);for(var f=this._result.length,d=0;d<f;++d)this._real_reel[a]=this._result[d],a=(a+1)%this._reel_length;b-=this._config.reelRotationDirection*this._config.imageHeight;this._final_offset=b+=this._bounce;0<this._dist_to_end&&(this._offset=this._final_offset-(1==this._config.reelRotationDirection?this._dist_to_end:-this._dist_to_end));break;case ReelView.REEL_BOUNCING:this.dispatchEvent(new Event(ReelView.REEL_BOUNCED));this._rotating=!1;var g=this;this._tween=TweenMax.to(this,
this._config.reelStopBounceTime,{getSetOffset:this._offset-this._bounce,ease:"Cubic.easeOut",onComplete:function(){l.call(g)},roundProps:"getSetOffset"});this._state_next=ReelView.REEL_IDLE}}function l(){this._state_next==ReelView.REEL_IDLE?(this._dispatchStop=!0,this._drawn_once=!1):c.call(this,this._state_next);this._tween=null}return{init:function(b,a){this._super();this._reel_index=a;this._y=this._x=0;this._config=b;this._real_reel=this._fake_reel=null;this._reel_length=0;this._result=null;this._offset=
this._config.imageHeight;this._final_offset=0;this._drawn_once=!1;this._state_next=this._state=ReelView.REEL_IDLE;this._stop_after_start=!1;this._stopped_state=ReelView.REEL_IDLE;this._rotating=!1;this._dist_to_end=-1;this._source_rect={};this._dest_point={};this._result_index=-1;this._bounce=0;this._dispatchStop=!1;this._tween=null;this._x=this._config.reelCoordX+this._reel_index*(this._config.reelWidth+this._config.reelSpacing);this._y=this._config.reelCoordY;this._bounce=Math.floor(this._config.reelRotationDirection*
this._config.imageHeight*this._config.reelStopBouncePercent/100);this._dest_point.x=this._x},getSetOffset:function(b){if(void 0==b)return this._offset;this._offset=b},getIndex:function(){return this._reel_index},getState:function(){switch(this._state){case ReelView.REEL_STARTING:case ReelView.REEL_ROTATING:return ReelView.REEL_ROTATING;case ReelView.REEL_STOPPING:case ReelView.REEL_BOUNCING:return ReelView.REEL_STOPPING}return ReelView.REEL_IDLE},changeFakeReel:function(b){this._reel_length=b.length;
this._fake_reel=[];this._real_reel=[];for(var a=0;a<this._reel_length;a++)this._fake_reel[a]=b[a],this._real_reel[a]=-1;b=this._result.length;for(a=0;a<b;a++)this._real_reel[a]=this._result[a];this._offset=this._config.imageHeight},setFakeReel:function(b){if(this._fake_reel)throw"Trying to set the fake reel of reel "+this._reel_index+" twice";this._reel_length=b.length;this._fake_reel=[];this._real_reel=[];for(var a=0;a<this._reel_length;a++)this._fake_reel[a]=b[a],this._real_reel[a]=-1;this._result=
[];h.call(this)},setResult:function(b,a){var c=this._reel_index*(this._config.numReelImages+2),d=(k.call(this)+this._reel_length-1)%this._reel_length;a&&(this._result_index=d);for(var g=this._config.numReelImages+2,e=0;e<g;e++)a&&(this._real_reel[d]=b[c+e],d=(d+1)%this._reel_length),this._result[e]=b[e+c];this._drawn_once=!1;a&&this.draw(1)},start:function(){this._state==ReelView.REEL_IDLE&&(h.call(this),c.call(this,ReelView.REEL_STARTING),this._stopAfterStart=!1)},stop:function(b){void 0==b&&(b=
0);switch(this._state){case ReelView.REEL_STARTING:this._dist_to_end=-1;this._stop_after_start=!0;this._stopped_state=ReelView.REEL_STARTING;break;case ReelView.REEL_ROTATING:this._dist_to_end=b;c.call(this,ReelView.REEL_STOPPING);this._stopped_state=ReelView.REEL_ROTATING;break;case ReelView.REEL_STOPPING:this._offset=this._final_offset-(1==this._config.reelRotationDirection?b:-b),this._stopped_state=ReelView.REEL_STOPPING}},getDistToStop:function(){return this._state==ReelView.REEL_STOPPING?Math.abs(this._offset-
this._final_offset):-1},getDistToRest:function(){return this._state==ReelView.REEL_BOUNCING?Math.abs(this._offset-(this._final_offset-this._bounce)):-1},clearCell:function(b){this._config.context.clearRect(this._x,this._y+b*this._config.imageHeight,this._config.reelWidth,this._config.imageHeight)},redraw:function(){this._drawn_once=!1;this.draw(1)},draw:function(b){this._config.context.clearRect(0,0,1,1);if(this._state!=ReelView.REEL_IDLE||!this._drawn_once){this._drawn_once=!0;var a=this._offset;
this._offset+=this._rotating?this._config.reelRotationSpeed*b*this._config.reelRotationDirection:0;this._state==ReelView.REEL_STOPPING&&(1==this._config.reelRotationDirection&&this._offset>=this._final_offset||-1==this._config.reelRotationDirection&&this._offset<=this._final_offset)&&(this._offset=this._final_offset,c.call(this,ReelView.REEL_BOUNCING));b=this._reel_length*this._config.imageHeight;a%=b;0>a&&(a=b+a);this._source_rect.y=a%this._config.imageHeight;this._source_rect.width=this._config.reelWidth;
this._source_rect.height=this._config.imageHeight-this._source_rect.y;this._dest_point.y=0;a=Math.floor(a/this._config.imageHeight);for(1==this._config.reelRotationDirection&&(this._real_reel[(a+this._reel_length-1)%this._reel_length]=-1);this._dest_point.y<this._config.reelHeight;)b=this._real_reel[a],0>b&&(b=this._fake_reel[a]),this._source_rect.x=this._config.cardsInfo[b].x,this._source_rect.y+=this._config.cardsInfo[b].y,!0==this._config.transparentReels&&this._config.context.clearRect(this._dest_point.x,
this._dest_point.y+this._y,this._source_rect.width,this._source_rect.height),this._config.context.drawImage(this._config.reelImages[this._config.cardsInfo[b].reelImageIndex],this._source_rect.x,this._source_rect.y,this._source_rect.width,this._source_rect.height,this._dest_point.x,this._dest_point.y+this._y,this._source_rect.width,this._source_rect.height),this._dest_point.y+=this._source_rect.height,a=(a+1)%this._reel_length,this._source_rect.y=0,this._source_rect.height=this._config.imageHeight-
Math.max(0,this._dest_point.y-this._config.imageHeight*(this._config.numReelImages-1));if(-1==this._config.reelRotationDirection){b=-1==this._result_index?(k.call(this)+this._reel_length-2)%this._reel_length:(this._result_index+this._reel_length-1)%this._reel_length;do a++,a%=this._reel_length,this._real_reel[a]=-1;while(a!=b)}this._dispatchStop&&(c.call(this,ReelView.REEL_IDLE),this._dispatchStop=!1,this.dispatchEvent(new Event(ReelView.REEL_STOPPED)))}},dispose:function(){this._config=null;this._tween&&
(this._tween.kill(),this._tween=null);this._super()}}}());
