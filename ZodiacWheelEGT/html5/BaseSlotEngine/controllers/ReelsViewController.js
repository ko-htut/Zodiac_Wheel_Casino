ViewController("ReelsViewController",{REELS_STOPPED:"reelsStopped"},function(){function r(){for(var b=GameSettings.getInstance(),a=0;a<b.numReels;a++)if(this._reels[a].getState()==ReelView.REEL_ROTATING)return this._reels[a];return null}function w(b){if(!this._stopAllRequested&&SoundManager.getInstance().hasSound("reelAccelerateSound"))for(var a=GameSettings.getInstance(),c=a.serverMessage,d=0;d<a.numReelCards;d++){var e=SpinAnalyzer.getCard(b,d,c);if(!this._allowedAccelSound[e]&&void 0!=this._scatterCount[e]){for(var g,
k=a.scatterConfig.length,f=0;f<k;f++)if(a.scatterConfig[f].index==e){g=a.scatterConfig[f];break}f=a.freespinGame&&void 0!=g.freespinMinCountInFs?g.freespinMinCountInFs:g.freespinMinCount;if(-1!=f&&(this._scatterCount[e]++,k=1,void 0!=g.maxScatterOnReel&&(k=g.maxScatterOnReel),this._scatterCount[e]>=f-k)){k=!1;for(f=b+1;f<a.numReels;f++)if(g.validReels[f]&&this._reels[f].getState()==ReelView.REEL_ROTATING){k=!0;break}if(k){this._allowedAccelSound[e]=!0;break}}}}}function s(b){var a=GameSettings.getInstance(),
c=a.serverMessage;SoundManager.getInstance();for(var d,e,g,k=0;k<a.numReelCards;k++){d=SpinAnalyzer.getCard(b,k,c);var f=null;e=a.scatterConfig.length;for(var h=0;h<e;h++)if(a.scatterConfig[h].index==d){f=a.scatterConfig[h];break}if(null!=f&&f.validReels[b]){var l=1;void 0!=f.maxScatterOnReel&&(l=f.maxScatterOnReel);for(h=e=g=0;h<a.numReels;h++)f.validReels[h]&&(h<b?e+=SpinAnalyzer.countCardOnReel(h,d,c):h>b&&(g+=l));f=a.freespinGame&&void 0!=f.minCountInFs?f.minCountInFs:f.minCount;if(e+g+SpinAnalyzer.countCardOnReel(b,
d,c)>=f)for(e=a.scatterSounds.length,h=0;h<e;h++)if(a.scatterSounds[h].scatter==d)return h}}return-1}function n(){if(this._resultReceived){var b=r.call(this);if(b){var a=GameSettings.getInstance();b.stop();w.call(this,b.getIndex());for(var c=!1,d=a.scatterConfig.length,e=0;e<d;e++){var g=a.scatterConfig[e];if(this._allowedAccelSound[g.index]&&g.validReels[b.getIndex()+1]){c=!0;break}}var k=this;this._stopReelTimer=window.setTimeout(function(){n.call(k)},c?1500:a.gameBetweenReelsDelay)}}else this._initialRotationTimeElapsed=
!0,clearTimeout(this._stopReelTimer),this._stopReelTimer=0}function t(b){this._numReelsBounced++;b=b.target;var a=GameSettings.getInstance(),c=SoundManager.getInstance();this._accelSoundChannel=c.stop(this._accelSoundChannel);if(!this._stopAllRequested){a:{var d=GameSettings.getInstance();if(d.stopVideos)for(var e=d.serverMessage,g=b.getIndex(),k,f,h,l=0;l<d.numReelCards;l++)if(k=SpinAnalyzer.getCard(g,l,e),d.stopVideos[k]){f=null;for(h=0;h<d.scatterConfig.length;h++)if(d.scatterConfig[h].index==
k){f=d.scatterConfig[h];break}if(!f||-1!=s.call(this,g)){f=d.stopVideos[k];h=Loader.getLoader(f.src).getData();if(!h)break a;this._stopVideoPlayers[g]||(this._stopVideoPlayers[g]=[]);var m=this._stopVideoPlayers[g][k];m||(m=new VideoPlayer(h,this._stopVideosView.getContext2D(),f),m.addEventListener(VideoPlayer.VIDEO_COMPLETE,p,this),m.addEventListener(VideoPlayer.VIDEO_READY,q,this),this._stopVideoPlayers[g][k]=m,this._numberOfStopVideos++);f=g;f={x:d.reelCoordX+f*(d.reelWidth+d.reelSpacing),y:d.reelCoordY+
d.reelHeight/d.numReelCards*l,originalY:d.reelCoordY+d.reelHeight/d.numReelCards*l,row:l,col:f};this._stopVideoPlayers[g][k].addInstance(f);this._stopVideoImagesConfig[g]||(this._stopVideoImagesConfig[g]=[]);this._stopVideoImagesConfig[g][k]=f;this._stopVideoImagesConfig[g][k].y+=this._reels[g].getDistToRest()}}}e=b.getIndex();if(this._stopVideoPlayers[e])for(d=0;d<this._stopVideoPlayers[e].length;d++)this._stopVideoPlayers[e][d]&&this._stopVideoPlayers[e][d].play()}if(this._numReelsBounced<a.numReels){e=
r.call(this);g=!1;if(e)for(k=a.scatterConfig.length,d=0;d<k;d++)if(l=a.scatterConfig[d],this._allowedAccelSound[l.index]&&l.validReels[e.getIndex()]){g=!0;break}g&&(this._accelSoundChannel=c.play("reelAccelerateSound"))}if(this._stopAllRequested)this._numReelsBounced==a.numReels&&c.play("stopReelAllSound");else if(b=b.getIndex(),a=GameSettings.getInstance(),d=a.serverMessage,c=SoundManager.getInstance(),c.hasSound("stopWildSound")&&SpinAnalyzer.isCardOnReel(b,a.wildIndex,d))c.play("stopWildSound");
else{if(d=0!=a.wholeReelFiguresIndexes.length)b:{d=GameSettings.getInstance();e=d.serverMessage;g=d.wholeReelFiguresIndexes.length;k=0;if(this._shouldCheckOtherReelsForStackedSymbol)for(l=0;l<g;l++)if(f=d.wholeReelFiguresIndexes[l],SpinAnalyzer.countCardOnReel(b,f,e)==d.numReelCards){if(0==b){this._isFirstReelFullWithStackedSymbols=!0;this._indexOfStackedSymbol=f;d=!0;break b}for(h=0;h<d.numReels;h++)h<b&&SpinAnalyzer.countCardOnReel(h,f,e)==d.numReelCards&&k++;if(f==this._indexOfStackedSymbol&&this._isFirstReelFullWithStackedSymbols&&
this._shouldCheckOtherReelsForStackedSymbol||k==b){d=!0;break b}this._shouldCheckOtherReelsForStackedSymbol=!1}d=!1}d?c.play(a.wholeReelFiguresSounds[b]):(d=s.call(this,b),-1!=d?c.play(a.scatterSounds[d].sounds[b]):c.play("stopReelSound"))}}function u(b){GameSettings.getInstance();this.getReelsRotating()||v.call(this)}function v(){var b=GameSettings.getInstance();this._stopReelTimer&&(clearTimeout(this._stopReelTimer),this._stopReelTimer=0);for(var a=b.scatterConfig.length,c=0;c<a;c++){var d=b.scatterConfig[c];
this._scatterCount[d.index]=0;this._allowedAccelSound[d.index]=!1}this._stopAllRequested=!1;0!=b.wholeReelFiguresIndexes.length&&(this._isFirstReelFullWithStackedSymbols=!1,this._shouldCheckOtherReelsForStackedSymbol=!0,this._indexOfStackedSymbol=-1);this._lostConnection||this.dispatchEvent(new Event(ReelsViewController.REELS_STOPPED))}function p(b){var a;a:{b=b.target;a=GameSettings.getInstance();for(var c=0;c<a.numReels;c++)if(this._stopVideoPlayers[c])for(var d=this._stopVideoPlayers[c].length,
e=0;e<d;e++)if(this._stopVideoPlayers[c][e]==b){a=[c,e];break a}a=null}if(a){b=a[0];c=a[1];a=GameSettings.getInstance();c=this._stopVideoPlayers[b][c];for(e=0;e<a.numReelCards;e++)(d=this._stopVideoImagesConfig[b][e])&&(this._stopVideoImagesConfig[b][e]=null);c.removeEventListener(VideoPlayer.VIDEO_COMPLETE,p,this);c.removeEventListener(VideoPlayer.VIDEO_READY,q,this);c.dispose();this._numberOfStopVideos--;this._numberOfStopVideos||(this._stopVideoPlayers.length=0,this._stopVideoImagesConfig.length=
0);this.getReelsRotating()||v.call(this)}}function q(b){}return{init:function(b){this._super();this._reels;this._resultReceived;this._stopAllRequested;this._initialRotationTimeElapsed;this._stopReelTimer;this._lastTime;this._numReelsBounced;this._allowedAccelSound;this._scatterCount;this._accelSoundChannel;this._lostConnection;this._shouldCheckOtherReelsForStackedSymbol=!0;this._isFirstReelFullWithStackedSymbols=!1;this._indexOfStackedSymbol=-1;this._view=new View("",151,66);this._view.setSize(979,
540);this._reelsView=new CanvasView("",0,0);this._reelsView.setSize(979,540);this._view.addChild(this._reelsView);this._stopVideosView=new CanvasView("",0,0);this._stopVideosView.setSize(979,540);this._view.addChild(this._stopVideosView);var a=GameSettings.getInstance(),c=[];this._reels=[];for(var d=a.reelImages.length,e=0;e<d;e++)c[e]=Loader.getLoader(a.reelImages[e]).getData();for(e=0;e<a.numReels;e++)this._reels[e]=new ReelView({numReelImages:a.numReelCards,numImages:a.numImages,transparentReels:a.transparentReels,
reelCoordX:a.reelCoordX,reelCoordY:a.reelCoordY,reelWidth:a.reelWidth,reelHeight:a.reelHeight,imageHeight:a.imageHeight,reelSpacing:a.reelSpacing,reelImages:c,cardsInfo:a.cardsInfo,reelStartBounceTime:a.reelStartBounceTime,reelStopBounceTime:a.reelStopBounceTime,reelStopBouncePercent:a.reelStopBouncePercent,reelRotationSpeed:a.reelRotationSpeed,reelRotationDirection:a.reelRotationDirection,context:this._reelsView.getContext2D()},e),this._reels[e].setFakeReel(a.mainFakeReels[e]),this._reels[e].setResult(b,
!0),this._reels[e].addEventListener(ReelView.REEL_STOPPED,u,this),this._reels[e].addEventListener(ReelView.REEL_BOUNCED,t,this);this._scatterCount=[];this._allowedAccelSound=[];d=a.scatterConfig.length;for(e=0;e<d;e++)b=a.scatterConfig[e],this._scatterCount[b.index]=0,this._allowedAccelSound[b.index]=!1;this._stopVideoPlayers=[];this._stopVideoImagesConfig=[];this._numberOfStopVideos=0;this._initialRotationTimeElapsed=this._stopAllRequested=this._lostConnection=!1},getReelsRotating:function(){for(var b=
GameSettings.getInstance(),a=0;a<b.numReels;a++)if(this._reels[a].getState()!=ReelView.REEL_IDLE)return!0;return this._stopVideoPlayers.length?!0:!1},getStopAllRequested:function(){return this._stopAllRequested},start:function(){if(!this.getReelsRotating()){for(var b=GameSettings.getInstance(),a=0;a<b.numReels;a++)this._reels[a].start();if(this._stopReelTimer)throw"_stopReelTimer should be null when the reels are starting!";var b=Math.max(b.gameInitialReelRotationTime,1E3*b.minimumSpinTime-((b.numReels-
1)*b.gameBetweenReelsDelay+((b.numReelCards+1)*b.reelRotationSpeed+1E3*b.reelStopBounceTime))),c=this;this._stopReelTimer=setTimeout(function(){n.call(c)},b);this._initialRotationTimeElapsed=this._resultReceived=!1;this._numReelsBounced=0}},stopAll:function(){var b=GameSettings.getInstance();if(this.getReelsRotating()&&!(0<b.minimumSpinTime)){if(this._resultReceived)for(var a=b.reelHeight,c=0;c<b.numReels;c++)this._reels[c].stop(a);this._stopAllRequested=!0;this._stopReelTimer&&(clearTimeout(this._stopReelTimer),
this._stopReelTimer=0)}},resultReceived:function(){var b=GameSettings.getInstance(),a=b.serverMessage;if(a.type!=BaseMessage.SPIN)throw"Incorrect message type in resultReceived in ReelsViewController!";for(var c=0;c<b.numReels;c++)this._reels[c].setResult(a.reels);this._resultReceived=!0;this._stopAllRequested?this.stopAll():this._initialRotationTimeElapsed&&n.call(this)},setReels:function(b){var a=GameSettings.getInstance();if(this.getReelsRotating())throw"Cannot set reels if they are not stopped!";
for(var c=0;c<a.numReels;c++)this._reels[c].setResult(b,!0)},clearReels:function(b){for(var a=b.length,c=0;c<a;c+=2)this._reels[b[c]].clearCell(b[c+1])},setMainFakeReels:function(b){},setFreespinFakeReels:function(b){},redrawReels:function(){for(var b=GameSettings.getInstance(),a=0;a<b.numReels;a++)this._reels[a].redraw()},onLostConnection:function(){this._lostConnection=!0;this._stopReelTimer&&(clearTimeout(this._stopReelTimer),this._stopReelTimer=0)},newFrame:function(b){for(var a=GameSettings.getInstance(),
c=0;c<a.numReels;c++)if(this._reels[c].draw(b),this._stopVideoImagesConfig[c])for(var d=0;d<this._stopVideoImagesConfig[c].length;d++)if(this._stopVideoImagesConfig[c][d]){var e=this._reels[c].getDistToRest();-1!=e&&(this._stopVideoImagesConfig[c][d].y=this._stopVideoImagesConfig[c][d].originalY+e)}},dispose:function(){for(var b=this._reels.length,a=0;a<b;a++)this._reels[a].removeEventListener(ReelView.REEL_STOPPED,u,this),this._reels[a].removeEventListener(ReelView.REEL_BOUNCED,t,this),this._reels[a].dispose();
this._reels=null;this._stopReelTimer&&clearTimeout(this._stopReelTimer);b=this._stopVideoPlayers.length;for(a=0;a<b;a++)for(var c=0;c<this._stopVideoPlayers[a].length;c++)this._stopVideoPlayers[a][c].removeEventListener(VideoPlayer.VIDEO_COMPLETE,p,this),this._stopVideoPlayers[a][c].removeEventListener(VideoPlayer.VIDEO_READY,q,this),this._stopVideoPlayers[a][c].dispose();this._accelSoundChannel&&SoundManager.getInstance().stop(this._accelSoundChannel);this._stopVideoImagesConfig=this._stopVideoPlayers=
null;this._super()}}}());
